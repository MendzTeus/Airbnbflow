import{X as U,a1 as I,V as L,a2 as O,r as o,j as e,G as j,H as g,J as f,K as y,M as D,Q as v,T as p,ab as $,ac as B,ad as M,ae as V,af as A}from"./index-CFBfUQr5.js";import{L as i}from"./label-Cdm9zhvV.js";import{C as H}from"./checkbox-DKLiD9us.js";import{A as J,C as G,a as K}from"./alert-BKCop9Vh.js";import{A as Q}from"./arrow-left-s31EvzC8.js";import{U as X}from"./users-BU5ZOGGK.js";function se(){const n=U(),{id:u}=I(),t=!!u,{getEmployeeById:N,addEmployee:F,updateEmployee:P,properties:b}=L(),{toast:c}=O(),[a,d]=o.useState({name:"",email:"",phone:"",role:"cleaner",startDate:new Date().toISOString().split("T")[0],properties:[]}),[k,C]=o.useState(t),[E,S]=o.useState(!1),[w,m]=o.useState("");o.useEffect(()=>{if(t){const s=N(u);s?d({...s,startDate:new Date(s.startDate).toISOString().split("T")[0]}):(m("Employee not found"),c({variant:"destructive",title:"Error",description:"Employee not found."}),n("/employees")),C(!1)}else C(!1)},[u,t,N,n,c]);const h=s=>{const{name:r,value:l}=s.target;d(x=>({...x,[r]:l}))},T=(s,r)=>{d(l=>({...l,[s]:r}))},q=s=>{d(r=>{const l=r.properties||[];return l.includes(s)?{...r,properties:l.filter(x=>x!==s)}:{...r,properties:[...l,s]}})},R=async s=>{s.preventDefault(),m(""),S(!0);try{if(!a.name||!a.email||!a.phone||!a.role||!a.startDate)throw new Error("Please fill in all required fields.");if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.email))throw new Error("Please enter a valid email address.");t?await P(a):await F(a),n("/employees")}catch(r){r instanceof Error?(m(r.message),c({variant:"destructive",title:"Error",description:`Failed to save employee: ${r.message}`})):(m("An unexpected error occurred"),c({variant:"destructive",title:"Error",description:"An unexpected error occurred while saving the employee."}))}finally{S(!1)}};return k?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"})}):e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs(j,{variant:"ghost",onClick:()=>n("/employees"),className:"mb-4",children:[e.jsx(Q,{className:"mr-2 h-4 w-4"})," Back to Employees"]}),e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:t?"Edit Employee":"Add New Employee"}),e.jsx("p",{className:"text-muted-foreground",children:t?"Update employee details and property assignments":"Add a new team member to your MCRh team"})]}),e.jsx("form",{onSubmit:R,children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(g,{className:"lg:col-span-2",children:[e.jsxs(f,{children:[e.jsx(y,{children:"Employee Information"}),e.jsx(D,{children:"Enter basic information about the employee"})]}),e.jsxs(v,{className:"space-y-4",children:[w&&e.jsxs(J,{variant:"destructive",children:[e.jsx(G,{className:"h-4 w-4"}),e.jsx(K,{children:w})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"name",children:"Full Name*"}),e.jsx(p,{id:"name",name:"name",value:a.name||"",onChange:h,placeholder:"e.g. John Smith",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"email",children:"Email Address*"}),e.jsx(p,{id:"email",name:"email",type:"email",value:a.email||"",onChange:h,placeholder:"e.g. john@example.com",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"phone",children:"Phone Number*"}),e.jsx(p,{id:"phone",name:"phone",value:a.phone||"",onChange:h,placeholder:"e.g. 555-123-4567",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"role",children:"Role*"}),e.jsxs($,{value:a.role||"",onValueChange:s=>T("role",s),children:[e.jsx(B,{id:"role",children:e.jsx(M,{placeholder:"Select role"})}),e.jsxs(V,{children:[e.jsx(A,{value:"manager",children:"Property Manager"}),e.jsx(A,{value:"cleaner",children:"Cleaner"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"startDate",children:"Start Date*"}),e.jsx(p,{id:"startDate",name:"startDate",type:"date",value:a.startDate||"",onChange:h,required:!0})]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(g,{children:[e.jsxs(f,{children:[e.jsx(y,{children:"Property Assignments"}),e.jsx(D,{children:"Assign properties to this employee"})]}),e.jsx(v,{children:e.jsx("div",{className:"space-y-4",children:Object.values(b).length===0?e.jsx("p",{className:"text-muted-foreground",children:"No properties available"}):Object.values(b).map(s=>e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(H,{id:`property-${s.id}`,checked:(a.properties||[]).includes(s.id),onCheckedChange:()=>q(s.id)}),e.jsxs("div",{className:"grid gap-1.5 leading-none",children:[e.jsx(i,{htmlFor:`property-${s.id}`,className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.city})]})]},s.id))})})]}),e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(y,{children:"Actions"})}),e.jsxs(v,{className:"space-y-2",children:[e.jsx(j,{type:"submit",className:"w-full",disabled:E,children:E?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin mr-2 h-4 w-4 border-2 border-background border-t-transparent rounded-full"}),t?"Updating...":"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"mr-2 h-4 w-4"}),t?"Update Employee":"Create Employee"]})}),e.jsx(j,{type:"button",variant:"outline",className:"w-full",onClick:()=>n("/employees"),children:"Cancel"})]})]})]})]})})]})}export{se as default};
