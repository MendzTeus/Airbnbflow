import{a1 as R,X as V,E as D,V as k,a2 as A,r as w,z as U,ah as O,j as e,G as C,H as z,J as B,K as G,M as H,Q as $,ab as j,ac as g,ad as y,ae as v,af as i,T as J,a5 as K,U as Q,al as o,ai as X}from"./index-CFBfUQr5.js";import{F as W,a as l,b as d,c as m,d as u,e as I,f as h,S as Y}from"./separator-CeNxhGK4.js";import{A as Z}from"./arrow-left-s31EvzC8.js";import"./label-Cdm9zhvV.js";const ee=o.object({propertyId:o.string({required_error:"Please select a property"}),title:o.string({required_error:"Please enter a title for this request"}).min(3,{message:"Title must be at least 3 characters"}),description:o.string({required_error:"Please provide a description"}).min(10,{message:"Description must be at least 10 characters"}),priority:o.enum(["low","medium","high"],{required_error:"Please select a priority level"}),status:o.enum(["open","in-progress","completed"],{required_error:"Please select a status"}),assignedTo:o.string().optional()});function re(){const{id:c}=R(),p=V(),{t:n}=D(),{properties:F,employees:P,getMaintenanceRequestById:q,addMaintenanceRequest:N,updateMaintenanceRequest:E}=k(),{toast:x}=A(),[b,S]=w.useState(!1),r=!!c,T=U(),M=Object.values(F),_=Object.values(P),f="__unassigned__",t=O({resolver:X(ee),defaultValues:{propertyId:"",title:"",description:"",priority:"medium",status:"open",assignedTo:void 0}});w.useEffect(()=>{if(r&&c){const s=q(c);s?t.reset({propertyId:s.propertyId,title:s.title,description:s.description,priority:s.priority,status:s.status,assignedTo:s.assignedTo??void 0}):(x({variant:"destructive",title:"Error",description:"Maintenance request not found."}),p("/maintenance"))}else{const a=new URLSearchParams(T.search).get("propertyId");a&&t.setValue("propertyId",a)}},[r,c,q,t,p,T.search,x]);const L=async s=>{S(!0);try{const a={propertyId:s.propertyId,title:s.title,description:s.description,priority:s.priority,status:s.status,assignedTo:s.assignedTo===""?void 0:s.assignedTo};r&&c?await E({...a,id:c}):await N(a),x({title:r?"Maintenance request updated":"Maintenance request created",description:r?"The maintenance request has been updated successfully.":"A new maintenance request has been created."}),p("/maintenance")}catch(a){console.error("Error saving maintenance request:",a),x({variant:"destructive",title:"Error",description:`Failed to save maintenance request. ${a instanceof Error?a.message:""}`})}finally{S(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{variant:"ghost",size:"icon",onClick:()=>p("/maintenance"),children:e.jsx(Z,{className:"h-4 w-4"})}),e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:n(r?"common.edit":"maintenance.newRequest")})]}),e.jsxs(z,{children:[e.jsxs(B,{children:[e.jsx(G,{children:n(r?"common.edit":"maintenance.newRequest")}),e.jsx(H,{children:r?n("common.edit")+" "+n("maintenance.title").toLowerCase():n("common.create")+" "+n("maintenance.title").toLowerCase()})]}),e.jsx(W,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(L),children:[e.jsxs($,{className:"space-y-4",children:[e.jsx(l,{control:t.control,name:"propertyId",render:({field:s})=>e.jsxs(d,{children:[e.jsx(m,{children:n("accessCodes.property")}),e.jsxs(j,{onValueChange:s.onChange,value:s.value,children:[e.jsx(u,{children:e.jsx(g,{children:e.jsx(y,{placeholder:"Select a property"})})}),e.jsx(v,{children:M.map(a=>e.jsx(i,{value:a.id,children:a.name},a.id))})]}),e.jsxs(I,{children:[n("accessCodes.property")," ",n("common.for")," ",n("maintenance.title").toLowerCase()]}),e.jsx(h,{})]})}),e.jsx(Y,{}),e.jsx(l,{control:t.control,name:"title",render:({field:s})=>e.jsxs(d,{children:[e.jsx(m,{children:n("maintenance.requestTitle")}),e.jsx(u,{children:e.jsx(J,{placeholder:"Leaking faucet, broken window, etc.",...s})}),e.jsx(h,{})]})}),e.jsx(l,{control:t.control,name:"description",render:({field:s})=>e.jsxs(d,{children:[e.jsx(m,{children:n("common.description")}),e.jsx(u,{children:e.jsx(K,{placeholder:"Provide details about the maintenance issue...",className:"min-h-[120px]",...s})}),e.jsx(h,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(l,{control:t.control,name:"priority",render:({field:s})=>e.jsxs(d,{children:[e.jsx(m,{children:n("common.priority")}),e.jsxs(j,{onValueChange:s.onChange,value:s.value,children:[e.jsx(u,{children:e.jsx(g,{children:e.jsx(y,{placeholder:"Select priority"})})}),e.jsxs(v,{children:[e.jsx(i,{value:"low",children:n("maintenance.priority.low")}),e.jsx(i,{value:"medium",children:n("maintenance.priority.medium")}),e.jsx(i,{value:"high",children:n("maintenance.priority.high")})]})]}),e.jsx(h,{})]})}),e.jsx(l,{control:t.control,name:"status",render:({field:s})=>e.jsxs(d,{children:[e.jsx(m,{children:n("common.status")}),e.jsxs(j,{onValueChange:s.onChange,value:s.value,children:[e.jsx(u,{children:e.jsx(g,{children:e.jsx(y,{placeholder:"Select status"})})}),e.jsxs(v,{children:[e.jsx(i,{value:"open",children:n("maintenance.status.open")}),e.jsx(i,{value:"in-progress",children:n("maintenance.status.inProgress")}),e.jsx(i,{value:"completed",children:n("maintenance.status.completed")})]})]}),e.jsx(h,{})]})})]}),e.jsx(l,{control:t.control,name:"assignedTo",render:({field:s})=>e.jsxs(d,{children:[e.jsx(m,{children:n("maintenance.assignedTo")}),e.jsxs(j,{onValueChange:a=>s.onChange(a===f?void 0:a),value:s.value??f,children:[e.jsx(u,{children:e.jsx(g,{children:e.jsx(y,{placeholder:"Assign to employee (optional)"})})}),e.jsxs(v,{children:[e.jsx(i,{value:f,children:"Unassigned"}),_.map(a=>e.jsxs(i,{value:a.id,children:[a.name," (",a.role,")"]},a.id))]})]}),e.jsxs(I,{children:[n("maintenance.assignedTo")," ",n("common.for")," ",n("maintenance.title").toLowerCase()]}),e.jsx(h,{})]})})]}),e.jsxs(Q,{className:"flex justify-between",children:[e.jsx(C,{variant:"outline",onClick:()=>p("/maintenance"),children:n("common.cancel")}),e.jsx(C,{type:"submit",disabled:b,children:n(b?"common.loading":r?"common.save":"common.create")})]})]})})]})]})}export{re as default};
