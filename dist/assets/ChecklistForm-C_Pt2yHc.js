import{a1 as K,X as J,E as Q,a2 as W,y as X,V as Y,r as o,ah as Z,ai as ee,aj as se,ak as te,j as e,G as x,H as ae,J as re,K as ie,M as ce,Q as B,ab as ne,ac as le,ad as oe,ae as de,af as me,a5 as he,U as pe,al as n,a9 as xe}from"./index-CFBfUQr5.js";import{F as ue,a as C,b,c as v,d as N,e as je,f as L,S as fe}from"./separator-CeNxhGK4.js";import{C as ke}from"./checkbox-DKLiD9us.js";import{P as ye}from"./progress-BMeFLOzC.js";import{A as ge}from"./arrow-left-s31EvzC8.js";import{T as Ce}from"./trash-2-DDAci78G.js";import{P as be}from"./plus-Cvcf7KTe.js";import"./label-Cdm9zhvV.js";const ve=n.object({itemId:n.string().optional(),text:n.string({required_error:"Checklist item text is required"}).min(1,{message:"Checklist item text is required"}),completed:n.boolean().optional()}),Ne=n.object({propertyId:n.string({required_error:"Please select a property"}).min(1,{message:"Please select a property"}),items:n.array(ve).min(1,{message:"Add at least one checklist item"})}),j=()=>typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():Math.random().toString(36).slice(2,11),Ie=["Dust and wipe all surfaces","Vacuum or mop floors","Clean mirrors and windows","Refresh linens and towels","Empty trash bins","Sanitize kitchen counters","Check appliances are off","Restock toiletries"];function Me(){const{id:d}=K(),r=!!d,m=J(),{t:a}=Q(),{toast:h}=W(),{user:f}=X(),{checklists:I,properties:k,getChecklistById:S,addChecklist:V,updateChecklist:z}=Y(),[w,F]=o.useState(!1),[$,T]=o.useState(r),[A,q]=o.useState(null),P=Z({resolver:ee(Ne),defaultValues:{propertyId:"",items:[...Ie.map(s=>({itemId:j(),text:s,completed:!1}))]}}),{control:p,reset:D,handleSubmit:R}=P,{fields:y,append:_,remove:O}=se({control:p,name:"items"}),i=te({control:p,name:"items"}),E=o.useMemo(()=>(i==null?void 0:i.filter(s=>s==null?void 0:s.completed).length)??0,[i]),g=(i==null?void 0:i.length)??0,G=g>0?Math.round(E/g*100):0;o.useEffect(()=>{if(!r||!d){T(!1);return}const s=S(d);s?(q(s),D({propertyId:s.propertyId,items:s.items.length>0?s.items.map(t=>({itemId:t.id,text:t.text,completed:!!t.completed})):[{itemId:j(),text:"",completed:!1}]}),T(!1)):Object.keys(I).length>0&&(h({variant:"destructive",title:"Checklist not found",description:"The checklist you are trying to edit could not be found."}),m("/checklists"))},[r,d,S,D,I,h,m]);const H=async s=>{var U;F(!0);const t=s.items.map(c=>({id:c.itemId&&c.itemId.length>0?c.itemId:j(),text:c.text,completed:!!c.completed})),l=((U=k[s.propertyId])==null?void 0:U.name)??"Property",u={propertyId:s.propertyId,title:`${l} â€“ Cleaning Checklist (${xe(new Date,"PP")})`,type:"checkin",assignedTo:f==null?void 0:f.id,items:t};try{r&&d&&A?(await z({...A,...u}),h({title:"Checklist updated",description:"The checklist has been updated successfully."})):(await V(u),h({title:"Checklist created",description:"A new checklist has been created successfully."})),m("/checklists")}catch(c){console.error("Error saving checklist",c),h({variant:"destructive",title:"Error",description:"Failed to save the checklist. Please try again."})}finally{F(!1)}},M=o.useMemo(()=>Object.values(k),[k]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>m("/checklists"),children:e.jsx(ge,{className:"h-4 w-4"})}),e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:a(r?"common.edit":"checklists.newChecklist")})]}),e.jsxs(ae,{children:[e.jsxs(re,{children:[e.jsx(ie,{children:r?"Update cleaning checklist":"New cleaning checklist"}),e.jsx(ce,{children:"Select the property you are cleaning and mark each task as you finish."})]}),$?e.jsx(B,{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"h-12 w-12 animate-spin rounded-full border-4 border-muted border-t-primary"})}):e.jsx(ue,{...P,children:e.jsxs("form",{onSubmit:R(H),children:[e.jsxs(B,{className:"space-y-6",children:[e.jsx(C,{control:p,name:"propertyId",render:({field:s})=>e.jsxs(b,{children:[e.jsx(v,{children:a("checklists.property")}),e.jsxs(ne,{onValueChange:s.onChange,value:s.value,children:[e.jsx(N,{children:e.jsx(le,{children:e.jsx(oe,{placeholder:"Select a property"})})}),e.jsx(de,{children:M.length===0?e.jsx("div",{className:"px-3 py-2 text-sm text-muted-foreground",children:"No properties available"}):M.map(t=>e.jsx(me,{value:t.id,children:t.name},t.id))})]}),e.jsx(je,{children:a("checklists.propertyDescription")||"Choose which property this checklist belongs to."}),e.jsx(L,{})]})}),e.jsx(fe,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Cleaning tasks"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Check each task as you finish it."})]}),e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsxs("span",{className:"font-medium",children:[E,"/",g," done"]}),e.jsx(ye,{value:G,className:"h-2 w-40"})]})]}),y.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"Add at least one item to the checklist."}):e.jsx("div",{className:"space-y-4",children:y.map((s,t)=>e.jsxs("div",{className:"rounded-md border p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-medium",children:["Task ",t+1]}),y.length>1&&e.jsx(x,{type:"button",variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive",onClick:()=>O(t),"aria-label":"Remove item",children:e.jsx(Ce,{className:"h-4 w-4"})})]}),e.jsx(C,{control:p,name:`items.${t}.text`,render:({field:l})=>e.jsxs(b,{children:[e.jsx(v,{className:"sr-only",children:a("checklists.itemText")||"Item text"}),e.jsx(N,{children:e.jsx(he,{rows:2,placeholder:"Describe the task",...l})}),e.jsx(L,{})]})}),e.jsx(C,{control:p,name:`items.${t}.completed`,render:({field:l})=>e.jsxs(b,{className:"flex items-center space-x-2",children:[e.jsx(N,{children:e.jsx(ke,{checked:!!l.value,onCheckedChange:u=>l.onChange(u===!0)})}),e.jsx(v,{className:"font-normal",children:"Mark as already complete"})]})})]},s.id))}),e.jsxs(x,{type:"button",variant:"outline",size:"sm",onClick:()=>_({itemId:j(),text:"",completed:!1}),children:[e.jsx(be,{className:"mr-2 h-4 w-4"})," Add custom task"]})]})]}),e.jsxs(pe,{className:"flex justify-between",children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>m("/checklists"),children:a("common.cancel")}),e.jsx(x,{type:"submit",disabled:w,children:a(w?"common.loading":r?"common.save":"common.create")})]})]})})]})]})}export{Me as default};
